#T-Bank — Blocking Payments Case#

##Запрос бизнеса:##
1)Разработать спецификацию в формате OpenAPI endpoint’ов для реализации возможности:
заблокировать платежи конкретного клиента 
разблокировать платежи клиента
роверить, заблокирован ли клиент
отличать блокировки мошенников от блокировок добропорядочных клиентов

2)Разработать структуру хранения информации (необходимой для 1 пункта)  в БД

##Структура репозитория##
.
├─ README.md
├─ openapi.yaml
└─ db_structure/
   ├─ db.sql
   └─ RED_db.png

##Обзор спецификации API##
./openapi.yaml

POST /clients/{clientId}/blocks
Назначение: Создать активную блокировку клиенту.
В параметрах передаётся ID клиента.
В теле запроса передаётся тип блокировки [FRAUD, INCORRECT_DETAILS, OTHER], описание причины и дата снятия блокировки.
Пример запроса: ...

GET /clients/{clientId}/blocks
Назначение: Получить список всех блокировок клиента
В параметрах передаётся ID клиента.
Ответ 200 содержит список всех блокировок и их данные. 
Пример запроса: ...

GET /clients/{clientId}/blocks/active
Назначение: Быстрая проверка наличия активной блокировки у клиента.
Ответ 200 содержит статус наличия активной блокировки, её id и тип [FRAUD, INCORRECT_DETAILS, OTHER].
Пример запроса: ...

POST /clients/{clientId}/blocks/{blockId}/release
Назначение: Снять блокировку с клиента
В параметрах передаётся ID клиента и ID блокировки.
Пример запроса: ...




##Обзор структуры базы данных##
ER-диаграмма - ./ERD_db_structure/db.png
Таблица client_block хранит список всех блокировок. 
Она содержит поля: 
id - идентификатор блокировки
client_id - идентификатор клиента
block_type - тип блокировки [FRAUD, INCORRECT_DETAILS, OTHER]
status - [ACTIVE, RELEASED, EXPIRED]
reason - причина блокирвоки
created_at - Когда была создана блокировка 
created_by - Кем была создана блокировка 
released_at - Когда снята блокировка
released_by - Кем снята блокировка 
release_reason - Причина снятия блокировки\
expires_at - дата снятия блокировки 

Таблица audit_log содержит логи всех действий связаных с блокировкой
id - идентификатор блокировки
event_time - дата и время события
actor - администратор
action - действие 
client_id - идентификатор клиента
block_id - идентификатор блокировки
details - доп. информация 


SQL - ./db_structure/db.sql

Код для создания необходимых таблиц.



Условие запрещающее создавать одному клиенту более одной активной блокировки:
CREATE UNIQUE INDEX IF NOT EXISTS uq_client_block_active
  ON client_block (client_id)
  WHERE status = 'ACTIVE';



